workspace:
  base: /drone
  path: src/github.com/uswitch/terraform-provider-segment

pipeline:
  build: 
    image: golang:1
    commands:
      - make build

  package:
    when:
      event: tag
    image: golang:1
    commands:
      - make release

  publish:
    when:
      event: tag
    image: plugins/github-release
    settings:
      api_key:
        from_secret: github_token
      files:
        - build/*